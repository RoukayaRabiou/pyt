---
title: "Atelier 1 - R"
subtitle: "Introduction aux types de données, structures et     graphiques." 
author: "Marie-Joël Dandoga, VP-Education CSD"
date: "1er Octobre 2019"
output:
  ioslides_presentation:
    css: script.txt
    incremental: yes
    logo: logo_officiel.png
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction 

### **1. Généralités**

* R est un logiciel gratuit à code source ouvert (open-source) qui a l'avantage d'être disponible sur plusieurs plateformes (Windows, Macintosh, UNIX).
  
* Ce logiciel sert à manipuler des données, faire des calculs, tracer des graphiques et faire des analyses statistiques sur ces données.
  
* L'outil est très efficace lorsqu'on maîtrise le langage R puisque l'on devient alors capable de créer ses propres outils, ce qui permet ainsi d'opérer des analyses très sophistiquées sur les données.

***

### **2. Attributions**
Le logiciel R possède entre autres:

* Un système de documentation intégré très bien conçu (en anglais);
* Des procédures efficaces de traitement et de stockage des données, tant statistiques qu'analytiques;
* Une suite d'opérateurs sur le calcul sur les tableaux et surtout sur les matrices;
* Des capacités graphiques évoluées;
* Un langage de programmation simple et efficace intégrant les conditions, les boucles ou récursivités etc.

* Il sera donc question dans cet atelier d'explorer quelques de ces éléments de programmation de base en vue de permettre à un auditoire débutant d'acquérir, par une pratique régulière et autodidacte, une expertise plus évoluée.


## R est une calculatrice.

>- *__Attention, le separateur decimal doit etre un point (.)__*
``` {r}
25*(-7.04); cos(4*pi/5); (12*(1.5-0.5))/3
```
***
>- *__Deux opérations identiques__*
``` {r}
10^2
```
``` {r}
10**2
```
***
>- *__Racine carrée__*
``` {r}
sqrt(81)
```
>- *__exponentielle et logarithme de base naturelle__*
``` {r}
exp(2.35)
log(7.8/(3-2.5))
```


## Création d'objet dans R
Pour créer un objet dans R, on utilise la syntaxe suivante :

**Nom.objet.a.creer <- instructions**

__*Remarque:*__ R est sensible à la casse. Tout nom de variable ne peut être constitué que de caractères alphanumériques ainsi que du point (.) ; un nom de variable ne peut pas contenir des espaces ou commencer par un chiffre, sauf s'il est encadré de guillemets "".

***

## **Exercice 1** {.build} 
L'indice de Quételet ou IMC est défini par IMC = poids/taille² où le poids est exprimé en kg et la taille en m. Calculer votre IMC ou celui de quelqu'un que vous connaissez! Créer une variable appelée imc conservant cette valeur.

 **Solution**
``` {r}
   Mon.Poids <- 70 
   Ma.Taille <- 1.78 
   Mon.IMC   <- Mon.Poids/Ma.Taille^2
   Mon.IMC
```

***

## Les structures de données
Le point de départ d'une analyse de données en R est d'avoir accès aux données. Ces données doivent être stockées dans un ou des objets R. Pour utiliser R, il faut donc d'abord connaître les différents types d'objets pouvant servir de « contenant à données » et savoir travailler avec ces objets.

Il existe différents types de structures de données en R tels que *les veteurs, les matrices, les tableaux, les listes, etc.*

***

### **Les vecteurs**
Structure de donnée la plus simple qui représente une collection de donées de même type.  
Plusieurs fonctions permettent de créer des vecteurs:

``` {r}
vec0 <- c(1,2,3,4,5)
vec0
vec1 <- c(TRUE,1865,5.2,"hello")
vec1
``` 

*__Remarque:__* Un vecteur peut contenir une collection d'objet de types différents; R se charge alors de les convertir de façon implicite dans le type le plus général.

***

``` {r}
vec2 <- seq(from=10, to=100, by=10)
vec2
vec3 <- 1:10
vec3
```

***

### **Matrices et tableaux**
Ils généralisent la notion de vecteur puisqu'ils représentent une collection d'objets **homogènes** à double entrées pour les matrices et plusieurs entrées pour les tableaux.

``` {r}
X <- matrix(1:12,nrow=4,ncol=3,byrow=TRUE)
X
```

***

``` {r}
Z <- array(1:12,dim=c(2,2,3))
Z
```

***

### **Les listes** 
Structure de donées du langage R la plus souple et la plus riche. Elle permet de stocker différents types de données différentes sans les altérer. De façon générale, une liste peut contenir un vecteur, un tableau, un booléen ou même une liste.

``` {r}
ma.liste <- list(-1:1, matrix(seq(0,1,0.2),2,3), T,
                 "une chaine de caractere")
```

***

```{r}
ma.liste
```

***

### **Le data.frame**
* Il s'agit d'un tableau croisé comportant les individus en lignes et les variables mesurées sur ceux-ci en colonnes. C'est la structure de données par excellence en statistique. Chaque variable ou colonne doit contenir des données du même type.

### **Les facteurs (*factor*) et les variables ordinales (*ordered*)** 
* R permet d'organiser les chaines de caractères de façon plus astucieuse au moyen de la fonction *factor()*. Il est bien évidemment possible de mettre des facteurs dans un *data.frame*. R indique les différents niveaux (*levels*) du facteur. La fonction *factor()* est donc celle à utiliser pour stocker des **variables qualitatives**. 
Pour les **variables ordinales**, il est
plutôt conseillé d'utiliser la fonction *ordered()*.

***

```{r}
pal <- factor(c("bleu","vert","bleu","rouge","bleu","vert","vert"))
pal

nivo <- ordered(c("Petit","Grand","Moyen","Grand","Moyen","Petit","Petit"),
levels=c("Petit","Moyen","Grand"))
nivo
```


***

### **Excercice 2**
Un échantillon de dossiers d'enfants a été saisi. Ce sont des enfants vus lors d'une visite en 1ère section de maternelle en 1996-1997 dans des écoles de Bordeaux (Gironde, France). L'échantillon présenté ici est constitué de 8 enfants âgés
de 3 ou 4 ans. 
Les données disponibles pour chaque enfant sont :
Le sexe (F ou G), Le fait que leur école soit située en Zone d'éducation Prioritaire (O pour oui et N pour non), l'âge en années et mois à la date de la visite, le poids en kg, La taille en cm.

***

```{r include = FALSE, echo = FALSE}
Prenom = c("Erika","Celia","Eric","Eve","Paul","Jean","Adan","Louis");
Sexe   = c(rep("F",2),"G","F",rep("G",4));
ZEP    = c(rep("O",4),"N","O","N",rep("O",1));
Annees = c(3,3,3,4,3,4,3,3);
Mois   = c(5,10,5,0,8,0,11,9);
Poids  = c(16,14,13.5,15.4,16.5,16,17,14.8);
Taille = c(100.0,97.0,95.5,101.0,100.0,98.5,103.0,98.0);
Donnees= data.frame(Prenom, Sexe, ZEP, Annees, Mois, Poids, Taille);

Donnees
```

``` {r warning = FALSE, echo = FALSE, results = 'asis'}
library(knitr)
kable(Donnees, format = "markdown")
```

***
1. Créer dans R les variables Prenom, Poids, Taille et Sexe correspondants à l'échantillon.

2. Calculer la moyenne et la variance des variables pour lesquelles cela est possible.

3. Calculer l'IMC des individus et regrouper les valeurs obtenues dans un vecteur
nommé IMC.

4. Regrouper ces variables dans la structure R qui vous paraît la plus adaptée.

5. Utiliser l'aide en ligne de R afin d'obtenir des informations sur la fonction plot() et tracer le nuage de points du Poids en fonction de la Taille. Penser à fournir un titre à votre graphique et à annoter vos axes.

***

__*Solution:*__
```{r}
#1
Prenom = c("Erika","Celia","Eric","Eve","Paul","Jean","Adan","Louis");
Sexe   = c(rep("F",2),"G","F",rep("G",4));
Poids  = c(16,14,13.5,15.4,16.5,16,17,14.8);
Taille = c(100.0,97.0,95.5,101.0,100.0,98.5,103.0,98.0);

#2
mean(Poids); mean(Taille)
```

***

``` {r}
var (Poids); var (Taille);

#3
IMC    = Poids/((Taille/100)^2);

#4
Donnees= data.frame(Prenom, Sexe, Poids, Taille, IMC);

## Sujet 2, colonne 3
Donnees[2,3]
```

***

``` {r}
## Sujet 2, toutes les valeurs associees
Donnees[2,]
## Toutes les valeurs de la variable poids (colonne 3)
Donnees[,3]
Donnees$Poids
```

***

```{r}
#5
plot(Poids~Taille,
     main="Titre: Poids en fonction de la taille",
     col="orangered",
     pch=17)

```

## **Instructions de condition**
* La prise de décision est un élément essentiel de la programmation. En R ceci peut être réalisé par l'instruction *if...else* (voir l'aide pour les détails de syntaxe)

* Le *if* est généralement suivi d'un *else*, cependant ce dernier n'est pas obligatoire.En effet, le *if* peut être suivi par une série d'autres *if* utilisant des conditions complémentaires. À la différence du *if*, le *else* n'a pas de condition. Il englobe simplement ce que le *if* a exclu.
Le paramètre *condition* doit être un logique qui prend donc l'une des valeurs **TRUE** ou **FALSE**. Bien évidemment, dans la pratique, *condition* sera souvent le résultat d'opérations logiques élaborées faisant intervenir les opérateurs.

***

```{r}
alpha <- rnorm(1,0,1); beta <- rt(1,10);
if (alpha < beta){
	print("alpha est plus petit que beta")
}else if (alpha == beta){
  	print("alpha est egal a beta")
}  else{
	print("alpha est plus grand que beta")
}
```

***


La fonction *ifelse()* dont la syntaxe est *ifelse(condition, Vrai, Faux)* permet d'exécuter l'une ou l'autre de deux instructions appliquées à un vecteur suivant que les valeurs d'une condition logique sont vraies ou fausses.

```{r}
alpha <- rnorm(1,0,1)
ifelse(alpha>0, "alpha positif", "alpha negatif")
```

## **Instructions de récursion**
Dans R la récursion est implémentée au moyen de boucles. Les instructions *for*, *while* et *repeat* permettent d'exécuter des boucles et il existe des mots réservés qui permettent de contrôler les itérations comme par exemple:

* *break* permet à tout moment d'arrêter le processus et de sortir de la boucle;
* *next* permet de passer à l'itération suivante.

```{r}
x <- c(1,3,7,2)
for (var in x) {print(2*var)}
```

## Importation de données

Il existe trois fonctions principales R à utiliser pour importer des données depuis un fichier texte :

* *read.table()* : à privilégier pour des jeux de données organisés sous la forme de tableaux, comme cela est souvent le cas en statistique.

* *read.ftable()* : Permet de lire des tableaux de contingence.

* *scan()* : Beaucoup plus flexible et puissante. Elle devra être utilisée dans tous les autres cas.

```{r}
setwd("~/R/notes de cours")
Data <- read.table("imc.txt")
```

***

```{r}
head(Data,4)
Data$V1[1]
attach(Data)
V2
```

## **Excercice récapitulatif** {.build}

###1. 
Afficher en une seule instruction dans R

* 10 élevé à la puissance des 10 premiers entiers non nuls.
* Le logarithme base 10 des 10 premiers entiers non nuls.
* La somme et la somme cumulée des 10 premiers entiers non nuls.
* Le produit et le produit cumulé des 10 premiers entiers non nuls.

Présenter convenablement ces valeurs sous la forme d'un tableau à double entrée comportant en lignes les 10 premiers entiers non nuls, et en colonne les puissances de dix, le log base 10, le produit et la somme cumulés.

***

###2.
Créer les trois vecteurs ci-dessous avec la fonction rep()

* v1 = 1 2 3 4 5 1 2 3 4 5 1 2 3 4 5
* v2 = 1 1 1 2 2 2 3 3 3 4 4 4 5 5 5
* v3 = 1 1 2 2 2 3 3 3 3 4 4 4 4 4 

* Créer la matrice mat ayant pour lignes les trois vecteurs ci-dessus; nommer les lignes et les colonnes selon votre préférence (pour les noms des lignes et des colonnes, utiliser les fonctions rownames() et colnames())
* Créer le vecteur contenant les éléments diagonaux de mat (utiliser la fonction diag()).
* Créer la matrice contenant uniquement les deux premières ligne de mat.
* Créer la matrice contenant uniquement les deux dernières colonnes de mat.

***

* Créer la matrice contenant toutes les colonnes de mat sauf la troisième.
* Calculer le déterminant de mat à l'aide de la fonction det() puis inverser la matrice à l'aide de solve().

###3.
Il existe dans R des données pré-existantes. Importez dans votre session R la base de données nommée WorldPhones (The World's Telephones). Afficher le contenu de la base de donnée.

* Calculer le nombre total de numéros de téléphone attribués :
  + Au cours des différentes années et le nommer *nbrTelAn*.
  + Pour chaque continent et le nommer *nbrTelCont*.
  
* Quel est le continent contenant le plus/moins de numéros de téléphone attribués ? Dans combien de continents y a-t-il plus de 20 000 numéros attribués ?

***

* Générer un tableau de fréquences contenant pour chaque continent:
  + le nombre de numéros attribués,
  + le pourcentage ainsi que le pourcentage cumulé.
  
* Effectuer un graphique montrant pour chaque continent, le pourcentage correspondant.

*__Note:__* 

* Un solutionnaire sera posté en ligne après la séance. 

* N'hésitez pas à consulter la *cheat sheet - R* disponible également sur le github du club

## *__Références__*

* Notes de cours STT1682, Folly Adjogoun Hiver 2018
* Structures de données en R, Sophie Baillargeon, Université Laval
2019-01-14

